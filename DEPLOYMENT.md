# Инструкции по деплою и обновлению

## ⚠️ ВАЖНО: Обновление статических файлов

При изменении файлов `script.js` или `styles.css` **ОБЯЗАТЕЛЬНО** нужно обновить их копии в папке `public/`:

```bash
# После изменения script.js или styles.css выполните:
cp script.js public/script.js
cp styles.css public/styles.css
git add public/script.js public/styles.css
git commit -m "Обновлены статические файлы"
git push origin main
```

### Почему это важно?

Vercel отдает статические файлы из папки `public/`, а не из корня проекта. Если не обновить файлы в `public/`, пользователи будут видеть старую версию, даже после деплоя.

## Процесс деплоя

1. **Внесите изменения** в `script.js` или `styles.css` в корне проекта
2. **Скопируйте файлы** в `public/`:
   ```bash
   cp script.js public/script.js
   cp styles.css public/styles.css
   ```
3. **Закоммитьте изменения**:
   ```bash
   git add .
   git commit -m "Описание изменений"
   git push origin main
   ```
4. **Проверьте деплой**:
   - Подождите 1-2 минуты
   - Откройте страницу в режиме инкогнито
   - Проверьте в Network, что файлы загружаются с версией (например, `/script.js?v=abc1234`)
   - Проверьте консоль браузера на наличие ошибок

## Версионирование файлов

Проект использует автоматическое версионирование статических файлов:
- Версия генерируется из git commit hash (если доступен) или timestamp
- Добавляется как query параметр: `/script.js?v=abc1234`
- Это гарантирует, что браузер загрузит новую версию после деплоя

## Настройки кэширования

- **HTML**: `Cache-Control: no-cache` - всегда актуальная версия
- **CSS/JS**: `Cache-Control: public, max-age=0, must-revalidate` - проверка актуальности при каждом запросе
- Версионирование обходит кэш CDN и браузера

## Автоматизация (опционально)

Можно добавить pre-commit hook для автоматического копирования файлов:

```bash
# Создать файл .git/hooks/pre-commit
#!/bin/sh
cp script.js public/script.js
cp styles.css public/styles.css
git add public/script.js public/styles.css
```

Или использовать GitHub Actions для автоматического обновления при пуше.

## Проверка после деплоя

После каждого деплоя проверьте:

1. ✅ Файлы загружаются с версией в URL (`/script.js?v=...`)
2. ✅ В консоли браузера нет ошибок
3. ✅ Новости загружаются корректно
4. ✅ Индикатор загрузки работает
5. ✅ Обработка ошибок работает

## Структура проекта

```
news-aggregator/
├── script.js          # Исходный файл (редактируйте этот)
├── styles.css         # Исходный файл (редактируйте этот)
├── public/
│   ├── script.js      # Копия для Vercel (обновляйте при изменении script.js)
│   └── styles.css     # Копия для Vercel (обновляйте при изменении styles.css)
├── server.js          # Серверный код
├── index.html         # HTML шаблон
└── vercel.json        # Конфигурация Vercel
```

## Известные проблемы

### Проблема: Новости не загружаются после деплоя

**Причина**: Файлы в `public/` не обновлены

**Решение**: 
```bash
cp script.js public/script.js
cp styles.css public/styles.css
git add public/ && git commit -m "Обновлены статические файлы" && git push
```

### Проблема: Вижу старую версию файла (x-vercel-cache: HIT)

**Причина**: Кэш Vercel еще не обновился

**Решение**: 
- Подождите 2-3 минуты
- Очистите кэш браузера (Ctrl+Shift+Delete)
- Откройте в режиме инкогнито
- Версионирование должно обойти кэш автоматически

## Контакты и поддержка

При возникновении проблем проверьте:
1. Обновлены ли файлы в `public/`
2. Загружаются ли файлы с версией в URL
3. Логи в консоли браузера
4. Логи Vercel деплоя

